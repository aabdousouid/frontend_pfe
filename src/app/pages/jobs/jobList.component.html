<p-toast></p-toast>
  <p-dialog [(visible)]="display" [breakpoints]="{ '960px': '75vw' }" [style]="{ width: '30vw' }" [modal]="true">
                   
                    
    <div class="card flex justify-center">
    <p-stepper [(value)]="activeStep" class="basis-[40rem]">
        <p-step-list>
            <p-step [value]="1" class="flex flex-row flex-auto gap-2">
                <ng-template #content let-activateCallback="activateCallback" let-value="value">
                    <button class="bg-transparent border-0 inline-flex flex-col gap-2" (click)="activateCallback()">
                        <span
                            class="rounded-full border-2 w-12 h-12 inline-flex items-center justify-center"
                            [ngClass]="{
                                'bg-primary text-primary-contrast border-primary': value <= activeStep,
                                'border-surface': value > activeStep
                            }"
                        >
                            <i class="pi pi-user"></i>
                        </span>
                    </button>
                </ng-template>
            </p-step>

            <p-step [value]="2" class="flex flex-row flex-auto gap-2">
                <ng-template #content let-activateCallback="activateCallback" let-value="value">
                    <button class="bg-transparent border-0 inline-flex flex-col gap-2" (click)="activateCallback()">
                        <span
                            class="rounded-full border-2 w-12 h-12 inline-flex items-center justify-center"
                            [ngClass]="{
                                'bg-primary text-primary-contrast border-primary': value <= activeStep,
                                'border-surface': value > activeStep
                            }"
                        >
                            <i class="pi pi-star"></i>
                        </span>
                    </button>
                </ng-template>
            </p-step>

            <p-step [value]="3" class="flex flex-row flex-auto gap-2">
                <ng-template #content let-activateCallback="activateCallback" let-value="value">
                    <button class="bg-transparent border-0 inline-flex flex-col gap-2" (click)="activateCallback()">
                        <span
                            class="rounded-full border-2 w-12 h-12 inline-flex items-center justify-center"
                            [ngClass]="{
                                'bg-primary text-primary-contrast border-primary': value <= activeStep,
                                'border-surface': value > activeStep
                            }"
                        >
                            <i class="pi pi-id-card"></i>
                        </span>
                    </button>
                </ng-template>
            </p-step>
        </p-step-list>

        <p-step-panels>
            <p-step-panel [value]="1">
                <ng-template #content let-activateCallback="activateCallback">
                    <div class="flex flex-col gap-2 mx-auto" style="min-height: 16rem; max-width: 20rem">
                        <div class="text-center mt-4 mb-4 text-xl font-semibold">Créer une offre d'emploi</div>
                         <label class="filter-label">Titre</label>
                        <div class="field">
                            <input [(ngModel)]="form.title" pInputText id="title" type="text" placeholder="Titre du poste" fluid />
                        </div>
                         <label class="filter-label">Entreprise</label>
                        <div class="field">
                            <input [(ngModel)]="form.company" pInputText id="company" type="text" placeholder="Entreprise" fluid />
                        </div>
                         <label class="filter-label">Description</label>
                        <div class="field">
                           <textarea pTextarea placeholder="Your Description" id="" [(ngModel)]="form.description" [autoResize]="true" rows="3" cols="30"></textarea>
                        </div>
                    </div>
                    <div class="flex pt-6 justify-end">
                        <p-button (onClick)="activateCallback(2)" label="Next" icon="pi pi-arrow-right" iconPos="right" />
                    </div>
                </ng-template>
            </p-step-panel>

            <p-step-panel [value]="2">
                <ng-template #content let-activateCallback="activateCallback">
                    <div class="flex flex-col gap-2 mx-auto" style="min-height: 16rem; max-width: 24rem">
                        <div class="text-center mt-4 mb-4 text-xl font-semibold">Choisissez vos compétences professionnelles</div>
                        <div class="flex flex-wrap justify-center gap-4">
                          <p-togglebutton [(ngModel)]="option1" onLabel="Java" offLabel="Java" (onChange)="updateRequirements()" />
                          <p-togglebutton [(ngModel)]="option2" onLabel="Angular" offLabel="Angular" (onChange)="updateRequirements()" />
                          <p-togglebutton [(ngModel)]="option3" onLabel="Springboot" offLabel="Springboot" (onChange)="updateRequirements()" />
                          <p-togglebutton [(ngModel)]="option4" onLabel="Devops" offLabel="Devops" (onChange)="updateRequirements()" />
                          <p-togglebutton [(ngModel)]="option5" onLabel="Python" offLabel="Python" (onChange)="updateRequirements()" />
                          <p-togglebutton [(ngModel)]="option6" onLabel="Machine-Learning" offLabel="Machine Learning" (onChange)="updateRequirements()" />
                          <p-togglebutton [(ngModel)]="option7" onLabel="SQL" offLabel="SQL" (onChange)="updateRequirements()" />
                          <p-togglebutton [(ngModel)]="option8" onLabel="Javascript" offLabel="Javascript" (onChange)="updateRequirements()" />
                          <p-togglebutton [(ngModel)]="option9" onLabel="NodeJS" offLabel="Node JS" (onChange)="updateRequirements()" />
                          <p-togglebutton [(ngModel)]="option10" onLabel="Docker" offLabel="Docker" (onChange)="updateRequirements()" />
                        </div>
                        <div class="flex gap-2 mt-4 justify-center items-center">
                        <input
                          type="text"
                          pInputText
                          placeholder="Ajouter une compétence"
                          [(ngModel)]="customSkillInput"
                          (keydown.enter)="addCustomSkill()"
                          style="width: 200px"
                        />
                        <p-button icon="pi pi-plus" (onClick)="addCustomSkill()" label="Ajouter"></p-button>
                      </div>

                      <div *ngIf="form.skills.length > 0" class="flex gap-2 flex-wrap mt-3 justify-center">
                        <p-chip
                          *ngFor="let skill of form.skills; let idx = index"
                          [label]="skill"
                          (onRemove)="removeSkill(idx)"
                          removable="true"
                          class="bg-blue-50"
                        ></p-chip>
                      </div>
                    </div>
                    <div class="flex pt-6 justify-between">
                        <p-button (onClick)="activateCallback(1)" label="Back" severity="secondary" icon="pi pi-arrow-left" />
                        <p-button (onClick)="activateCallback(3)" label="Next" icon="pi pi-arrow-right" iconPos="right" />
                    </div>
                </ng-template>
            </p-step-panel>

            <p-step-panel [value]="3">
                <ng-template #content let-activateCallback="activateCallback">
                    <div class="flex flex-col gap-2 mx-auto" style="min-height: 16rem; max-width: 24rem">
                        <div class="text-center mt-4 mb-4 text-xl font-semibold">Informations supplémentaires</div>
                        <label class="filter-label">Localisation</label>
                        <div class="field">
                            
                            <p-select class="filter-dropdown" [(ngModel)]="form.location" [options]="dropdownValues" optionLabel="name" placeholder="Localisation" />
                        </div>
                        <label class="filter-label">Type d'emploi</label>
                         <div class="field">
                            
                            <p-select class="filter-dropdown" [(ngModel)]="form.jobType" [options]="dropdownValuesJob" optionLabel="name" placeholder="Type" />
                        </div>
                        <!-- <label class="filter-label">Salary Range</label>
                         <div class="field">
                            
                            <p-select class="filter-dropdown" [(ngModel)]="form.salaryRange" [options]="dropdownValuesSalary" optionLabel="name" placeholder="salary Range" />
                        </div> -->

                        <label class="filter-label">Exigences</label>
                         <div class="field">
                            
                            <textarea pTextarea placeholder="Exigences du poste" id="" [(ngModel)]="form.requirements" [autoResize]="true" rows="3" cols="30"></textarea>
                        </div>


                        <label class="filter-label">Experience</label>
                         <div class="field">
                            
                           <input [(ngModel)]="form.experience" pInputText id="company" type="text" placeholder="Experience" fluid />
                        </div>
                        <label class="filter-label">Urgency</label>
                        <div class="field">
                          <p-toggleswitch [(ngModel)]="form.isUrgent" />
                        </div>
                    </div>
                    <div class="flex pt-6 justify-between">
                        <p-button (onClick)="activateCallback(2)" label="Back" severity="secondary" icon="pi pi-arrow-left" />
                        <p-button icon="pi pi-plus" iconPos="left" (onClick)="onsubmit()" />
                    </div>
                </ng-template>
            </p-step-panel>
        </p-step-panels>
    </p-stepper>
</div>
                    
                    <ng-template #footer>
                       <!--  <p-button label="Add Job" (click)="close()" /> -->
                    </ng-template>
        </p-dialog>
    <div class="job-list-container">
      <!-- Header Section -->
      <div class="header-section">
        <div class="title-section">
          <h1 class="main-title">Nos offres d'emploi et de stages</h1>
          <p class="subtitle">Découvrez les opportunités qui correspondent à vos compétences et à vos aspirations</p>
          
        </div>
        
        <!-- Search and Filters -->
        <p-card class="search-filter-section">
          @if(isAdmin==true) {
          <div style="padding: 2rem;">
          <p-button icon="pi pi-plus" severity="success" text raised rounded (onClick)="open()"/>
          </div>}
          <div class="search-bar">
            <span class="p-input-icon-left search-input-wrapper">
              <i class="pi pi-search"></i>
              <input 
                type="text" 
                pInputText 
                placeholder="Recherchez des emplois, des entreprises ou des keywords..." 
                [(ngModel)]="searchQuery"
                (input)="onSearchChange()"
                class="search-input"
              />
            </span>
          </div>
          
          <div class="filters-row">
            <div class="filter-group">
              <label class="filter-label">Localisation</label>
              <p-dropdown 
                [options]="filterOptions.locations"
                [(ngModel)]="selectedLocation"
                placeholder="All Locations"
                [showClear]="true"
                (onChange)="applyFilters()"
                class="filter-dropdown"
              ></p-dropdown>
            </div>
            
            <div class="filter-group">
              <label class="filter-label">Catégorie des offres</label>
              <p-dropdown 
                [options]="filterOptions.jobTypes"
                [(ngModel)]="selectedJobType"
                placeholder="All Types"
                [showClear]="true"
                (onChange)="applyFilters()"
                class="filter-dropdown"
              ></p-dropdown>
            </div>
            
            <div class="filter-group">
              <label class="filter-label">Experience</label>
              <p-dropdown 
                [options]="filterOptions.experienceLevels"
                [(ngModel)]="selectedExperience"
                placeholder="All Levels"
                [showClear]="true"
                (onChange)="applyFilters()"
                class="filter-dropdown"
              ></p-dropdown>
            </div>
            
            <div class="filter-group">
              <label class="filter-label">Skills</label>
              <p-multiSelect 
                [options]="filterOptions.skills"
                [(ngModel)]="selectedSkills"
                placeholder="Select Skills"
                [showClear]="true"
                (onChange)="applyFilters()"
                class="filter-multiselect"
                [maxSelectedLabels]="2"
              ></p-multiSelect>
            </div>
            
            <div class="filter-actions">
              <p-button 
                label="Clear All" 
                icon="pi pi-times" 
                [outlined]="true" 
                (onClick)="clearFilters()"
                class="clear-btn"
              ></p-button>
            </div>
          </div>
        </p-card>
      </div>

      <!-- Results Summary -->
      <div class="results-summary">
        <div class="results-info">
          <span class="results-count">{{ filteredJobs.length }} jobs found</span>
          <span class="results-text">• Updated {{ lastUpdated | date:'short' }}</span>
        </div>
        
        <div class="sort-section">
          <label class="sort-label">Sort by:</label>
          <p-dropdown 
            [options]="sortOptions"
            [(ngModel)]="selectedSort"
            (onChange)="applySorting()"
            class="sort-dropdown"
          ></p-dropdown>
        </div>
      </div>

      <!-- Job Cards Grid -->
      <div class="jobs-grid" *ngIf="!loading; else loadingTemplate">
        <div class="job-card-wrapper" *ngFor="let job of paginatedJobs; trackBy: trackByJobId">
          <p-card class="job-card" [class.urgent-job]="job.isUrgent">
            <div class="job-card-header">
              <div class="company-info">
                <div class="company-logo" *ngIf="job.companyLogo">
                  <img [src]="job.companyLogo" [alt]="job.company + ' logo'" />
                </div>
                <div class="company-logo-placeholder" *ngIf="!job.companyLogo">
                  {{ job.company.charAt(0).toUpperCase() }}
                </div>
                <div class="job-title-info">
                  <h3 class="job-title">{{ job.title }}</h3>
                  <p class="company-name">{{ job.company }}</p>
                </div>
              </div>
              
              <div class="job-badges">
                <p-badge 
                  *ngIf="job.isUrgent" 
                  value="Urgent" 
                  severity="danger"
                  class="urgent-badge"
                ></p-badge>
                <p-tag 
                  [value]="job.jobType" 
                  [severity]="getJobTypeSeverity(job.jobType)"
                  class="job-type-tag"
                ></p-tag>
              </div>
            </div>

            <div class="job-details">
              <div class="job-meta">
                <span class="meta-item">
                  <i class="pi pi-map-marker"></i>
                  {{ job.location }}
                </span>
                <span class="meta-item">
                  <i class="pi pi-briefcase"></i>
                  {{ job.experience }}
                </span>
               <!--  <span class="meta-item">
                  <i class="pi pi-dollar"></i>
                  {{ job.salary }}
                </span> -->
                <span class="meta-item">
                  <i class="pi pi-calendar"></i>
                  {{ getTimeAgo(job.postedDate) }}
                </span>
              </div>

              <p class="job-description">{{ job.description }}</p>

              <div class="job-skills">
                <p-chip 
                  *ngFor="let skill of job.skills.slice(0, 4)" 
                  [label]="skill"
                  class="skill-chip"
                ></p-chip>
                <span *ngIf="job.skills.length > 4" class="more-skills">
                  +{{ job.skills.length - 4 }} more
                </span>
              </div>
            </div>

            <p-divider></p-divider>

            <div class="job-actions">
              <p-button 
                label="Voir les détails" 
                icon="pi pi-eye" 
                [outlined]="true"
                (onClick)="viewJobDetails(job.jobId)"
                class="view-btn"
              ></p-button>
             <!--  <p-button 
                label="View Details" 
                icon="pi pi-close" 
                [outlined]="true"
                (onClick)="deleteJob(job)"
                class="view-btn"
              ></p-button> -->
              <p-button 
                label="Postuler" 
                icon="pi pi-send"
                (click)="applyToJob(job.jobId)"
                class="apply-btn"
              ></p-button>
            </div>
          </p-card>
        </div>
      </div>

      <!-- Loading Template -->
      <ng-template #loadingTemplate>
        <div class="jobs-skeleton">
          <div class="skeleton-card" *ngFor="let item of [1,2,3,4,5,6]">
            <p-skeleton height="200px"></p-skeleton>
          </div>
        </div>
      </ng-template>

      <!-- No Results -->
      <div class="no-results" *ngIf="filteredJobs.length === 0 && !loading">
        <i class="pi pi-search no-results-icon"></i>
        <h3>No jobs found</h3>
        <p>Try adjusting your search criteria or filters</p>
        <p-button 
          label="Clear Filters" 
          icon="pi pi-refresh" 
          (onClick)="clearFilters()"
          class="clear-all-btn"
        ></p-button>
      </div>

      <!-- Pagination -->
      <div class="pagination-wrapper" *ngIf="filteredJobs.length > 0">
        <p-paginator
          [rows]="itemsPerPage"
          [totalRecords]="filteredJobs.length"
          [first]="first"
          (onPageChange)="onPageChange($event)"
          [showCurrentPageReport]="true"
          currentPageReportTemplate="Showing {first} to {last} of {totalRecords} jobs"
        ></p-paginator>
      </div>
    </div>