<div class="job-application-container">
  <!-- Header with Breadcrumb -->
  <div class="header-section">
    <p-breadcrumb [model]="[
      {label: 'Offres demploi', routerLink: '/app/jobs'},
      {label: job?.title, routerLink: '/jobs/ux-ui-designer'},
      {label: 'Postuler'}
    ]" class="mb-4"></p-breadcrumb>
    
    <div class="admin-info">
      <i class="pi pi-calendar"></i>
      <span>{{currentDate}}</span>
      <i class="pi pi-user ml-3"></i>
      <span>Candidat Login</span>
    </div>
  </div>

  <!-- Info Alert -->
  <p-message 
    severity="info" 
    text="Vous ne pouvez postuler qu'une seule fois à cette offre avec la même adresse email."
    class="mb-4">
  </p-message>

  <div class="content-grid">
    <!-- Application Form -->
    <div class="form-section">
      <div class="form-card">
        <h2 class="form-title">
          <i class="pi pi-file-edit"></i>
          Formulaire de candidature - {{job?.title}}
        </h2>


        <div class="no-results" *ngIf="applied == true">
        <i class="pi pi-ban no-results-icon"></i>
        <h3>Vous avez déjà postulé pour ce poste.</h3>
        <p>Vous ne pouvez postuler qu'une seule fois à cette offre.</p>
        <!-- <p-button 
          label="Clear Filters" 
          icon="pi pi-refresh" 
          (onClick)="clearFilters()"
          class="clear-all-btn"
        ></p-button> -->
      </div>
        <form [formGroup]="applicationForm" (ngSubmit)="onSubmit()" *ngIf="applied ==false">
          <!-- Full Name Field -->
          <div class="field">
            <label for="fullName" class="required-field">Nom complet *</label>
            <input 
              id="fullName"
              type="text" 
              [(ngModel)]="this.user.username"
              pInputText 
              formControlName="fullName"
              [class.ng-invalid]="isFieldInvalid('fullName')"
              placeholder="Votre nom complet"
              class="w-full" />
            <small 
              *ngIf="getFieldError('fullName')" 
              class="p-error">
              {{ getFieldError('fullName') }}
            </small>
          </div>

          <!-- Email Field -->
          <div class="field">
            <label for="email" class="required-field">Email *</label>
            <input 
              id="email"
              type="email" 
              pInputText 
              [(ngModel)]="this.user.email"
              formControlName="email"
              [class.ng-invalid]="isFieldInvalid('email')"
              placeholder="votre.email@exemple.com"
              class="w-full" />
            <small class="field-hint">
              Nous utiliserons cette adresse pour vous contacter. Vous ne pourrez pas soumettre plusieurs candidatures avec le même email pour cette offre.
            </small>
            <small 
              *ngIf="getFieldError('email')" 
              class="p-error">
              {{ getFieldError('email') }}
            </small>
          </div>

          <!-- CV Upload Field -->
          <div class="field">
            <label class="required-field">CV (PDF uniquement) *</label>
            <p-fileUpload 
              #fileUpload
              mode="basic" 
              name="cv"
              accept=".pdf"
              [maxFileSize]="maxFileSize"
              [auto]="false"
              chooseLabel="Choisir un fichier"
              (onSelect)="onFileSelect($event)"
              (onRemove)="onFileRemove()"
              [showUploadButton]="false"
              [showCancelButton]="false"
              class="upload-field">
            </p-fileUpload>
            
            <!-- File Info -->
            <div *ngIf="uploadedFiles.length > 0" class="file-info mt-2">
              <div class="uploaded-file">
                <i class="pi pi-file-pdf text-red-500"></i>
                <span>{{ uploadedFiles[0].name }}</span>
                <span class="file-size">({{ (uploadedFiles[0].size / 1024 / 1024).toFixed(2) }} MB)</span>
                <button 
                  type="button" 
                  pButton 
                  icon="pi pi-times" 
                  class="p-button-text p-button-sm"
                  (click)="onFileRemove()">
                </button>
              </div>
            </div>
            
            <small class="field-hint">Taille maximale: 5 MB.</small>
            <small 
              *ngIf="getFieldError('cv')" 
              class="p-error">
              Ce champ est requis
            </small>
          </div>

          <!-- Action Buttons -->
          <div class="form-actions">
            <button 
              type="submit"
              pButton 
              label="Soumettre ma candidature"
              icon="pi pi-send"
              class="p-button-success submit-btn"
              [loading]="loading"
              [disabled]="!applicationForm.valid">
            </button>
            
            <button 
              type="button"
              pButton 
              label="Annuler"
              class="p-button-outlined cancel-btn"
              (click)="onCancel()">
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Job Info Sidebar -->
    <div class="info-section">
      <!-- Job Details Card -->
      <div class="info-card" *ngIf="jobOffer">
        <h3 class="info-title">Informations sur l'offre</h3>
        
        <div class="job-header">
          <h4>{{ job?.title }}</h4>
          <span *ngIf="job?.jobType" class="stage-badge">
            {{ job?.jobType }}
          </span>
          
        </div>
        
        <p class="job-description">{{ job?.description }}</p>
        
        <div class="publish-date">
          <i class="pi pi-calendar"></i>
          <span>Publié le {{ job?.postedDate | date:'dd/MM/yyyy HH:mm' }}</span>
        </div>
      </div>

      <!-- Recruitment Process Card -->
      <div class="info-card process-card">
        <h3 class="info-title">Processus de recrutement</h3>
        
        <div class="recruitment-steps">
          <div 
            *ngFor="let step of recruitmentSteps; let i = index" 
            class="step-item"
            [class.active]="i === 0">
            <div class="step-number">{{ step.step }}</div>
            <div class="step-content">
              <h5>{{ step.title }}</h5>
              <p>{{ step.description }}</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Toast Messages -->
<p-toast></p-toast>